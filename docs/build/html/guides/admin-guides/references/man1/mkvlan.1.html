

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mkvlan.1 &mdash; xCAT 2.12 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="xCAT 2.12 documentation" href="../../../../index.html"/>
        <link rel="up" title="man1" href="index.html"/>
        <link rel="next" title="mkvm.1" href="mkvm.1.html"/>
        <link rel="prev" title="mknimimage.1" href="mknimimage.1.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> xCAT
          

          
          </a>

          
            
            
              <div class="version">
                2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install-guides/index.html">Install Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Admin Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../basic_concepts/index.html">Basic Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../manage_clusters/index.html">Manage Clusters</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">References</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#xcat-man-pages">xCAT Man Pages</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="index.html">man1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../man3/index.html">man3</a></li>
<li class="toctree-l4"><a class="reference internal" href="../man5/index.html">man5</a></li>
<li class="toctree-l4"><a class="reference internal" href="../man7/index.html">man7</a></li>
<li class="toctree-l4"><a class="reference internal" href="../man8/index.html">man8</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#xcat-tools">xCAT Tools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../advanced/index.html">Advanced Topics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../developers/index.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../help.html">Need Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../security/index.html">Security Notices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../index.html">xCAT</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../index.html">Admin Guide</a> &raquo;</li>
      
          <li><a href="../index.html">References</a> &raquo;</li>
      
          <li><a href="index.html">man1</a> &raquo;</li>
      
    <li>mkvlan.1</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../../../_sources/guides/admin-guides/references/man1/mkvlan.1.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mkvlan-1">
<h1>mkvlan.1<a class="headerlink" href="#mkvlan-1" title="Permalink to this headline">¶</a></h1>
<div class="section" id="name">
<h2>NAME<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h2>
<p><strong>mkvlan</strong> - It takes a list of nodes and create a private tagged vlan for them.</p>
</div>
<div class="section" id="synopsis">
<h2>SYNOPSIS<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<p><strong>mkvlan</strong> [<em>vlanid</em>] <strong>-n | -</strong><strong>-nodes</strong> <em>noderange</em> [<strong>-t | -</strong><strong>-net</strong> <em>subnet</em>] [<strong>-m | -</strong><strong>-mask</strong> <em>netmask</em>] [<strong>-p | -</strong><strong>-prefix</strong> <em>hostname_prefix</em>] [<strong>-i | -</strong><strong>-interface</strong> <em>nic</em>]</p>
<p><strong>mkvlan</strong> [<strong>-h | -</strong><strong>-help</strong>]</p>
<p><strong>mkvlan</strong> [<strong>-v | -</strong><strong>-version</strong>]</p>
</div>
<div class="section" id="description">
<h2>DESCRIPTION<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <strong>mkvlan</strong> command takes a list of nodes and move them to a private vlan.</p>
<p>This command will configure the switch to create a new tagged vlan on the given nic. The primary nic will be used if the nic is not specified.  The new vlan ID is given by the command.  However, if it is omitted, xCAT will automatically generate the new vlan ID by querying all the switches involved and finding out the smallest common number that is not used by any existing vlans.  The subnet and the netmask for the vlan will be derived from the value of &#8220;vlannets&#8221; and &#8220;vlanmasks&#8221; from the <em>site</em> table if -t and -m are not specified. The following are the default site table entires:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="n">vlannets</span><span class="o">=</span><span class="s">&quot;|(\d+)|10.($1+0).0.0|&quot;</span><span class="p">;</span>
<span class="n">vlanmask</span><span class="o">=</span><span class="s">&quot;255.255.0.0&quot;</span><span class="p">;</span>
</pre></div>
</div>
<p>The vlan network will be entered in the <em>networks</em> table. The nodes will be added to the vlan using the vlan tagging technique. And the new IP addresses and new hostnames will be assigned to the nodes.  The -p flag specifies the node hostname prefix for the nodes.  If it is not specified, by default, the hostnames for the nodes are having the following format:</p>
<p>v&lt;vlanid&gt;nY  where Y is the node number. For example, the hostname for node 5 on vlan 10 is v10n5.</p>
<p>The <em>switch.vlan</em> will be updated with the new vlan id for the node for standaline nodes. For KVM guests, the <em>vm.nics</em> identifies which vlan this node belongs to. For example: vl3 means this node is in vlan 3.</p>
<p>If there are more than one switches involved in the vlan, the ports that connect to the switches need to entered in <em>switches.linkports</em> with the following format:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">port</span> <span class="n">numner</span><span class="o">&gt;</span><span class="p">:</span><span class="n">switch</span><span class="p">,</span><span class="o">&lt;</span><span class="n">port</span> <span class="n">number</span><span class="o">&gt;</span><span class="p">:</span><span class="n">switch</span><span class="o">....</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="s">&quot;42:switch1,43:switch2&quot;</span>
</pre></div>
</div>
<p>This command will automatically configure the cross-over ports if the given nodes are on different switches.</p>
<p>For added security, the root guard and bpdu guard will be enabled for the ports in this vlan. However, the guards will not be disabled if the ports are removed from the vlan using chvlan or rmvlan commands. To disable them, you need to use the switch command line interface. Refer to the switch command line interface manual to see how to disable the root guard and bpdu guard for a port.</p>
</div>
<div class="section" id="parameters">
<h2>PARAMETERS<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<p><em>vlanid</em> is a unique vlan number. If it is omitted, xCAT will automatically generate the new vlan ID by querying all the switches involved and finding out the smallest common number that is not used by any existing vlans. Use <strong>lsvlan</strong> to find out the existing vlan ids used by xCAT.</p>
</div>
<div class="section" id="options">
<h2>OPTIONS<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<p><strong>-n|-</strong><strong>-nodes</strong>     The nodes or groups to be included in the vlan. It can be stand alone nodes or KVM guests. It takes the noderange format. Check the man page for noderange for details.</p>
<p><strong>-t|-</strong><strong>-net</strong>       The subnet for the vlan.</p>
<p><strong>-m|-</strong><strong>-mask</strong>      The netmask for the vlan</p>
<p><strong>-p|-</strong><strong>-prefix</strong>    The prefix the the new hostnames for the nodes in the vlan.</p>
<p><strong>-i|-</strong><strong>-interface</strong> The interface name where the vlan will be tagged on. If omitted, the xCAT management network will be assumed. For FVM, this is the interface name on the host.</p>
<p><strong>-h|-</strong><strong>-help</strong>      Display usage message.</p>
<p><strong>-v|-</strong><strong>-version</strong>   The Command Version.</p>
</div>
<div class="section" id="return-value">
<h2>RETURN VALUE<a class="headerlink" href="#return-value" title="Permalink to this headline">¶</a></h2>
<p>0  The command completed successfully.</p>
<p>1  An error has occurred.</p>
</div>
<div class="section" id="examples">
<h2>EXAMPLES<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>To start, the xCAT switches and switches table needs to be filled with switch and port info for the nodes. For example, the swith table will look like this:</p>
<p>#node,switch,port,vlan,interface,comments,disable
&#8220;node1&#8221;,&#8221;switch1&#8221;,&#8221;10&#8221;,,,,
&#8220;node1&#8221;,&#8221;switch2&#8221;,&#8221;1&#8221;,,&#8221;eth1&#8221;,,
&#8220;node2&#8221;,&#8221;switch1&#8221;,&#8221;11&#8221;,,&#8221;primary&#8221;,,
&#8220;node2&#8221;,&#8221;switch2&#8221;,&#8221;2&#8221;,,&#8221;eth1&#8221;,,
&#8220;node3&#8221;,&#8221;switch1&#8221;,&#8221;12&#8221;,,&#8221;primary:eth0&#8221;,,
&#8220;node3&#8221;,&#8221;switch2&#8221;,&#8221;3&#8221;,,&#8221;eth1&#8221;,,</p>
<p>Note that the interface value for the management (primary) network can be empty, the word &#8220;primary&#8221; or &#8220;primary:ethx&#8221;. For other networks, the interface attribute must be specified.</p>
<p>The following is an example of the switches table</p>
<p>#switch,snmpversion,username,password,privacy,auth,linkports,sshusername,sshpassword,switchtype,comments,disable
&#8220;switch1&#8221;,&#8221;3&#8221;,&#8221;username&#8221;,&#8221;passw0rd&#8221;,,&#8221;sha&#8221;,&#8221;48:switch2&#8221;,,,,,
&#8220;switch2&#8221;,&#8221;2&#8221;,,,,,&#8221;43:switch1&#8221;,,,,,</p>
<ol class="arabic">
<li><p class="first">To make a private vlan for node1, node2 and node3</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="n">mkvlan</span> <span class="o">-</span><span class="n">n</span> <span class="n">node1</span><span class="p">,</span><span class="n">node2</span><span class="p">,</span><span class="n">node3</span>
</pre></div>
</div>
<p>The vlan will be created on eth0 for the nodes.</p>
</li>
<li><p class="first">To make a private vlan for node1, node2 and node3 on eth1,</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="n">mkvlan</span> <span class="o">-</span><span class="n">n</span> <span class="n">node1</span><span class="p">,</span><span class="n">node2</span><span class="p">,</span><span class="n">node3</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth1</span>
</pre></div>
</div>
</li>
<li><p class="first">To make a private vlan for node1, node2 with given subnet and netmask.</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="n">mkvlan</span> <span class="o">-</span><span class="n">n</span> <span class="n">node1</span><span class="p">,</span><span class="n">node2</span><span class="p">,</span><span class="n">node3</span> <span class="o">-</span><span class="n">t</span> <span class="mf">10.3.2.0</span> <span class="o">-</span><span class="n">m</span> <span class="mf">255.255.255.0</span>
</pre></div>
</div>
</li>
<li><p class="first">To make a private vlan for KVM guests node1 and node2</p>
<div class="highlight-perl"><div class="highlight"><pre><span class="n">chtab</span> <span class="n">key</span><span class="o">=</span><span class="n">usexhrm</span> <span class="n">site</span><span class="o">.</span><span class="n">vlaue</span><span class="o">=</span><span class="mi">1</span>

<span class="n">mkdef</span> <span class="n">node1</span> <span class="n">arch</span><span class="o">=</span><span class="n">x86_64</span> <span class="n">groups</span><span class="o">=</span><span class="n">kvm</span><span class="p">,</span><span class="n">all</span> <span class="n">installnic</span><span class="o">=</span><span class="n">mac</span> <span class="n">primarynic</span><span class="o">=</span><span class="n">mac</span> <span class="n">mgt</span><span class="o">=</span><span class="n">kvm</span> <span class="n">netboot</span><span class="o">=</span><span class="n">pxe</span> <span class="n">nfsserver</span><span class="o">=</span><span class="mf">10.1.0.204</span> <span class="n">os</span><span class="o">=</span><span class="n">rhels6</span> <span class="n">profile</span><span class="o">=</span><span class="n">compute</span> <span class="n">provmethod</span><span class="o">=</span><span class="n">install</span> <span class="n">serialport</span><span class="o">=</span><span class="mi">0</span> <span class="n">serialspeed</span><span class="o">=</span><span class="mi">115200</span> <span class="n">vmcpus</span><span class="o">=</span><span class="mi">1</span> <span class="n">vmhost</span><span class="o">=</span><span class="n">x3650n01</span> <span class="n">vmmemory</span><span class="o">=</span><span class="mi">512</span> <span class="n">vmnics</span><span class="o">=</span><span class="n">br0</span> <span class="n">vmstorage</span><span class="o">=</span><span class="n">nfs:</span><span class="sr">//</span><span class="mf">10.1.0.203</span><span class="o">/</span><span class="n">vms</span>

<span class="n">mkdef</span> <span class="n">node2</span> <span class="n">arch</span><span class="o">=</span><span class="n">x86_64</span> <span class="n">groups</span><span class="o">=</span><span class="n">kvm</span><span class="p">,</span><span class="n">all</span> <span class="n">installnic</span><span class="o">=</span><span class="n">mac</span> <span class="n">primarynic</span><span class="o">=</span><span class="n">mac</span> <span class="n">mgt</span><span class="o">=</span><span class="n">kvm</span> <span class="n">netboot</span><span class="o">=</span><span class="n">pxe</span> <span class="n">nfsserver</span><span class="o">=</span><span class="mf">10.1.0.204</span> <span class="n">os</span><span class="o">=</span><span class="n">rhels6</span> <span class="n">profile</span><span class="o">=</span><span class="n">compute</span> <span class="n">provmethod</span><span class="o">=</span><span class="n">install</span> <span class="n">serialport</span><span class="o">=</span><span class="mi">0</span> <span class="n">serialspeed</span><span class="o">=</span><span class="mi">115200</span> <span class="n">vmcpus</span><span class="o">=</span><span class="mi">1</span> <span class="n">vmhost</span><span class="o">=</span><span class="n">x3650n01</span> <span class="n">vmmemory</span><span class="o">=</span><span class="mi">512</span> <span class="n">vmnics</span><span class="o">=</span><span class="n">br0</span> <span class="n">vmstorage</span><span class="o">=</span><span class="n">nfs:</span><span class="sr">//</span><span class="mf">10.1.0.203</span><span class="o">/</span><span class="n">vms</span>

<span class="n">mkvlan</span> <span class="o">-</span><span class="n">n</span> <span class="n">node1</span><span class="p">,</span><span class="n">node2</span>

<span class="n">mkvm</span> <span class="n">node1</span><span class="p">,</span><span class="n">node2</span> <span class="o">-</span><span class="n">s</span> <span class="mi">20</span><span class="n">G</span>

<span class="n">rpower</span> <span class="n">node1</span><span class="p">,</span><span class="n">node2</span> <span class="n">on</span>

<span class="n">rinstall</span> <span class="n">node1</span><span class="p">,</span><span class="n">node2</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="files">
<h2>FILES<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h2>
<p>/opt/xcat/bin/mkvlan</p>
</div>
<div class="section" id="see-also">
<h2>SEE ALSO<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p>chvlan(1)|chvlan.1, rmvlan(1)|rmvlan.1, lsvlan(1)|lsvlan.1</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="mkvm.1.html" class="btn btn-neutral float-right" title="mkvm.1" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="mknimimage.1.html" class="btn btn-neutral" title="mknimimage.1" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, IBM Corporation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'2.12',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>