

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Cluster Name Resolution &mdash; xCAT 2.12 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="xCAT 2.12 documentation" href="../../index.html"/>
        <link rel="up" title="Domain Name Resolution" href="index.html"/>
        <link rel="next" title="GPUs" href="../gpu/index.html"/>
        <link rel="prev" title="Domain Name Resolution" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> xCAT
          

          
          </a>

          
            
            
              <div class="version">
                2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/install-guides/index.html">Install Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/admin-guides/index.html">Admin Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Advanced Topics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../chain/index.html">Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cluster_maintenance/index.html">Cluster Maintenance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../confluent/index.html">Confluent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docker/index.html">Docker</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Domain Name Resolution</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="">Cluster Name Resolution</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#set-the-site-domain-attribute">Set the site domain Attribute</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-xcat-network-definitions">Create xCAT Network Definitions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#populate-the-etc-hosts-file">Populate the /etc/hosts File</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preparing-for-using-a-dns">Preparing for Using a DNS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#option-1-running-dns-on-your-management-node">Option #1: Running DNS on Your Management Node</a></li>
<li class="toctree-l4"><a class="reference internal" href="#option-2-use-a-dns-that-is-outside-of-the-cluster">Option #2: Use a DNS That is Outside of the Cluster</a></li>
<li class="toctree-l4"><a class="reference internal" href="#option-3-run-dns-on-management-node-and-service-nodes">Option #3: Run DNS on Management Node and Service Nodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#specifying-additional-network-interfaces-for-cluster-nodes">Specifying additional network interfaces for cluster nodes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#managing-additional-interface-information-using-the-xcat-defs-commands">Managing additional interface information using the <strong>xCAT *defs</strong> commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-addition-interface-information-using-the-xcat-tabedit-command">Setting addition interface information using the xCAT tabedit command</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#limited-support-for-user-application-networks">Limited support for user application networks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../gpu/index.html">GPUs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hamn/index.html">High Availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hierarchy/index.html">Hierarchical Clusters / Large Cluster Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kit/index.html">Software Kits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mixed_cluster/index.html">Mixed Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networks/index.html">Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pdu/index.html">PDUs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ports/xcat_ports.html">Port Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../probe/index.html">xCAT probe</a></li>
<li class="toctree-l2"><a class="reference internal" href="../raid/index.html">RAID</a></li>
<li class="toctree-l2"><a class="reference internal" href="../restapi/index.html">Rest API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../softlayer/index.html">SoftLayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../switches/index.html">Switch Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysclone/index.html">System Clone (sysclone)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zones/index.html">Zones</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/index.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help.html">Need Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Notices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">xCAT</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Advanced Topics</a> &raquo;</li>
      
          <li><a href="index.html">Domain Name Resolution</a> &raquo;</li>
      
    <li>Cluster Name Resolution</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/advanced/domain_name_resolution/domain_name_resolution.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cluster-name-resolution">
<span id="dns-label"></span><h1>Cluster Name Resolution<a class="headerlink" href="#cluster-name-resolution" title="Permalink to this headline">¶</a></h1>
<p>Setting up name resolution and having the nodes be resolved to IP addresses are required in xCAT clusters.</p>
<p>There are many different ways to configure name resolution in your cluster. Four of the common choices will be described in this section (look for Option #: headings):</p>
<div class="highlight-python"><div class="highlight"><pre>1.In a basic (non-hierarchical) cluster, point all nodes to a DNS server running on the management node. This is the most common setup.
2.In a basic (non-hierarchical) cluster, point all nodes to an external DNS running at your site. This requires that all of your nodes have network connectivity to your site.
3.In a hierarchical cluster, point all compute nodes to their service node. Make service node as the compute nodes&#39; DNS server.
4.Don&#39;t use DNS, just distribute the /etc/hosts file to every node. If you choose this you will have to distribute new versions of the /etc/hosts file to all the cluster nodes whenever you add new nodes to the cluster, and you will have to specify site.master and all other server attributes in the database as IP addresses.
</pre></div>
</div>
<p>But before any of those options are chosen, there are some things that must be done for all of the options.</p>
<div class="section" id="set-the-site-domain-attribute">
<h2>Set the site domain Attribute<a class="headerlink" href="#set-the-site-domain-attribute" title="Permalink to this headline">¶</a></h2>
<p>First set the domain attribute in the xCAT site table to the hostname domain you want to use for your cluster nodes:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t site domain=mycluster.com
</pre></div>
</div>
</div>
<div class="section" id="create-xcat-network-definitions">
<h2>Create xCAT Network Definitions<a class="headerlink" href="#create-xcat-network-definitions" title="Permalink to this headline">¶</a></h2>
<p>When you installed xCAT, it ran <code class="docutils literal"><span class="pre">makenetworks</span></code> to create network definitions for the networks that the management node is connected to (i.e. has NICs configured for). If the cluster-facing NICs were not configured when xCAT was installed, or if there are more networks in the cluster that are only available via the service nodes or compute nodes, create the new network definitions now.</p>
<p>Use the <code class="docutils literal"><span class="pre">mkdef</span></code> command to add additional networks to the xCAT database. (See the network for information about each attribute.) For example:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdef -t network clusternet net=11.0.0.0 mask=255.255.0.0 gateway=11.0.0.254 domain=app.cluster.com
</pre></div>
</div>
<p>Note: The <code class="docutils literal"><span class="pre">makedns</span></code> command (mentioned below) will only add nodes into the DNS configuration if the network for the node is defined.</p>
<p>If you want to use a different hostname domain or a different set of nameservers for nodes that are on a particular network, set those attributes in the corresponding network object:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdef -t network clusternet domain=app.cluster.com nameservers=1.2.3.4
</pre></div>
</div>
</div>
<div class="section" id="populate-the-etc-hosts-file">
<h2>Populate the /etc/hosts File<a class="headerlink" href="#populate-the-etc-hosts-file" title="Permalink to this headline">¶</a></h2>
<p>All of the management node interfaces and all of the nodes need to be added to the <strong>/etc/hosts</strong> file on the xCAT management node (whether you are using the DNS option or not). You can either edit the <strong>/etc/hosts</strong> file by hand, or use <code class="docutils literal"><span class="pre">makehosts</span></code>.</p>
<p>If you edit the file by hand, it should look similar to:</p>
<div class="highlight-python"><div class="highlight"><pre>127.0.0.1  localhost localhost.localdomain
50.1.2.3  mgmtnode-public mgmtnode-public.cluster.com
10.0.0.100  mgmtnode mgmtnode.cluster.com
10.0.0.1  node1 node1.cluster.com
10.0.0.2  node2 node2.cluster.com
</pre></div>
</div>
<p>Verify that your <strong>/etc/hosts</strong> file contains entries for all of your management node interfaces. Manually add any that are missing.</p>
<p>If your node names and IP addresses follow a regular pattern, you can easily populate <strong>/etc/hosts</strong> by putting a regular expression in the xCAT hosts table and then running makehosts. To do this, you need to first create an initial definition of the nodes in the database, if you haven&#8217;t done that already:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdef node[01-80] groups=compute,all
</pre></div>
</div>
<p>Next, put a regular expression in the hosts table. The following example will associate IP address 10.0.0.1 with node1, 10.0.0.2 with node2, etc:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t group compute ip=&#39;|node(\d+)|10.0.0.($1+0)|&#39;
</pre></div>
</div>
<p>(For an explanation of the regular expressions, see the <code class="docutils literal"><span class="pre">man</span> <span class="pre">xcatdb</span></code>.) Then run:</p>
<div class="highlight-python"><div class="highlight"><pre>makehosts compute
</pre></div>
</div>
<p>and the following entries will be added to <strong>/etc/hosts</strong>:</p>
<div class="highlight-python"><div class="highlight"><pre>10.0.0.1 node01 node01.cluster.com
10.0.0.2 node02 node02.cluster.com
10.0.0.3 node03 node03.cluster.com
</pre></div>
</div>
<p>This information is used by the <code class="docutils literal"><span class="pre">makehosts</span></code> command to add the additional interface hostnames etc. to the <strong>/etc/hosts</strong> file. It is also used by xCAT adapter configuration postscripts to automatically configure the additional network interfaces on the node. See the section (refer to <a class="reference internal" href="#specifying-additional-network-interfaces-for-cluster-nodes"><span>Specifying additional network interfaces for cluster nodes</span></a> ).</p>
<p>Note that it is a convention of xCAT that for Linux systems the short hostname is the primary hostname for the node, and the long hostname is an alias. To have the long hostname be the primary hostname, you can use the -l option on the makehosts command.</p>
</div>
<div class="section" id="preparing-for-using-a-dns">
<h2>Preparing for Using a DNS<a class="headerlink" href="#preparing-for-using-a-dns" title="Permalink to this headline">¶</a></h2>
<p>If you are choosing any of the options for using DNS, follow these steps:</p>
<p>NOTE: This documentation only applies to the xCAT makedns command using the ddns.pm plugin. The ddns.pm plugin is based on named9/bind9, and can not support named8/bind8 due to syntax difference.</p>
<blockquote>
<div><ul class="simple">
<li>Set the <strong>nameservers</strong> and <strong>forwarders</strong> attributes in the xCAT site table. The <strong>nameservers</strong> attribute identifies the DNS server hostname/ip that the nodes point to in their <strong>/etc/resolv.conf</strong> files. The forwarders attribute are the DNS server&#8217;s ip that can resolve external hostnames. If you are running a DNS on the xCAT MN, it will use the forwarders DNS server to resolve any hostnames it can&#8217;t.</li>
</ul>
</div></blockquote>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>  chdef -t site nameservers=10.0.0.100 forwarders=9.14.8.1,9.14.8.2

* Create an /etc/resolv.conf file on the management node
</pre></div>
</div>
<p>Edit <strong>/etc/resolv.conf</strong> to contain the cluster domain value you set in the site table&#8217;s <strong>domain</strong>  attribute above, and to point to the same DNS server you will be using for your nodes (if you are using DNS).</p>
</div>
<div class="section" id="option-1-running-dns-on-your-management-node">
<h2>Option #1: Running DNS on Your Management Node<a class="headerlink" href="#option-1-running-dns-on-your-management-node" title="Permalink to this headline">¶</a></h2>
<p>This is the most common set up. In this configuration, a DNS running on the management node handles all name resolution requests for cluster node names. A separate DNS in your site handles requests for non-cluster hostnames.</p>
<p>There are several bits of information that must be included in the xCAT database before running the <code class="docutils literal"><span class="pre">makedns</span></code> command.</p>
<p>You must set the <strong>forwarders</strong> attribute in the xCAT cluster <strong>site</strong> definition. The <strong>forwarders</strong> value should be set to the IP address of one or more <strong>nameservers</strong> at your site that can resolve names outside of your cluster. With this set up, all nodes ask the local nameserver to resolve names, and if it is a name that the management node DNS does not know about, it will try the forwarder names.</p>
<p>An xCAT <strong>network</strong> definition must be defined for each management network used in the cluster. The <strong>net</strong> and <strong>mask</strong> attributes will be used by the <code class="docutils literal"><span class="pre">makedns</span></code> command.</p>
<p>A network <strong>domain</strong> and <strong>nameservers</strong> value must be provided either in the network definition corresponding to the nodes or in the site definition.</p>
<p>For example, if the cluster domain is <strong>mycluster.com</strong>, the IP address of the management node, (as known by the cluster nodes), is <strong>100.0.0.41</strong> and the site DNS servers are <strong>50.1.2.254,50.1.3.254</strong> then you would run the following command.</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t site domain=mycluster.com nameservers=100.0.0.41 forwarders=50.1.2.254,50.1.3.254
</pre></div>
</div>
<p>Once <strong>/etc/hosts</strong> is populated with all of the nodes&#8217; hostnames and IP addresses, configure DNS on the
management node and start it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">makedns</span> <span class="o">-</span><span class="n">n</span>
</pre></div>
</div>
<p>The <strong>resolv.conf</strong> files for the compute nodes will be created automatically using the <strong>domain</strong> and <strong>nameservers</strong> values set in the xCAT <strong>network</strong> or <strong>site</strong> definition.</p>
<p>If you add nodes or change node names or IP addresses later on, rerun makedns which will automatically restart named.</p>
<p>To verify the DNS service on management node is working or not:</p>
<div class="highlight-python"><div class="highlight"><pre>nslookup &lt;host&gt; &lt;mn&#39;s ip&gt;
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>nslookup node1 100.0.0.41
</pre></div>
</div>
</div>
<div class="section" id="option-2-use-a-dns-that-is-outside-of-the-cluster">
<h2>Option #2: Use a DNS That is Outside of the Cluster<a class="headerlink" href="#option-2-use-a-dns-that-is-outside-of-the-cluster" title="Permalink to this headline">¶</a></h2>
<p>If you already have a DNS on your site network and you want to use it to solve the node name in your cluster, follow the steps in this section to configure your external dns (against your local dns on xCAT MN/SN).</p>
<blockquote>
<div><ul>
<li><p class="first">Set the site <strong>nameservers</strong> value to the IP address of the external name server.</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t site nameservers=&lt;external dns IP&gt;
</pre></div>
</div>
</li>
<li><p class="first">Set the correct information of external dns into the /etc/resolv.conf on your xCAT MN.</p>
</li>
</ul>
</div></blockquote>
<p>The <strong>domain</strong> and <strong>nameservers</strong> values must be set correctly in <strong>/etc/resolv.conf</strong>. Which should have the same values with the ones your set in the site table.</p>
<blockquote>
<div><ul>
<li><p class="first">Manually set up your external dns server with correct named.conf and correct zone files</p>
</li>
<li><p class="first">Add the TSIG to the named.conf of your external dns for makedns command to update external dns</p>
<div class="highlight-python"><div class="highlight"><pre>tabdump -w key==omapi passwd
get the key like &quot;omapi&quot;,&quot;xcat_key&quot;,&quot;MFRCeHJybnJxeVBNaE1YT1BFTFJzN2JuREFMeEMwU0U=&quot;,,,,
Add it to your named.conf
key xcat_key {
     algorithm hmac-md5;
     secret &quot;MFRCeHJybnJxeVBNaE1YT1BFTFJzN2JuREFMeEMwU0U=&quot;;
};
</pre></div>
</div>
</li>
<li><p class="first">Then change each zone to make your zones to allow this key to update.</p>
<div class="highlight-python"><div class="highlight"><pre>zone &quot;1.168.192.IN-ADDR.ARPA.&quot; in {
     type master;
     allow-update {
             key xcat_key;
     };
     file &quot;db.192.168.1&quot;;
};
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><ul>
<li><p class="first">To update the name resolution entries from <code class="docutils literal"><span class="pre">/etc/hosts</span></code> or hosts table of xCAT MN to external DNS, run <code class="docutils literal"><span class="pre">makedns</span> <span class="pre">-e</span></code></p>
<p>Alternatively, you can set site.externaldns=1 and run <code class="docutils literal"><span class="pre">makedns</span></code></p>
</li>
</ul>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="option-3-run-dns-on-management-node-and-service-nodes">
<h2>Option #3: Run DNS on Management Node and Service Nodes<a class="headerlink" href="#option-3-run-dns-on-management-node-and-service-nodes" title="Permalink to this headline">¶</a></h2>
<p>When you have service nodes, the recommended configuration is to run DNS on the management node and all of the service nodes. Two choices are available:</p>
<div class="section" id="option-3-1-using-the-management-node-as-dns-server-the-service-nodes-as-forwarding-caching-servers">
<h3>Option #3.1: Using the management node as DNS server, the service nodes as forwarding/caching servers.<a class="headerlink" href="#option-3-1-using-the-management-node-as-dns-server-the-service-nodes-as-forwarding-caching-servers" title="Permalink to this headline">¶</a></h3>
<p>This means the <strong>DNS</strong> server on the management node is the only one configured with all of the node
hostname/IP address pairs. The DNS servers on the service nodes are simply forwarding/caching the
DNS requests to the management node.</p>
</div>
<div class="section" id="option-3-2-using-the-management-node-as-dns-master-the-service-nodes-as-dns-slaves">
<h3>Option #3.2: Using the management node as DNS master, the service nodes as DNS slaves.<a class="headerlink" href="#option-3-2-using-the-management-node-as-dns-master-the-service-nodes-as-dns-slaves" title="Permalink to this headline">¶</a></h3>
<p>This means the <strong>DNS</strong> server on the management node is configured with all of the node hostname/IP address
pairs, and allowed to transfer DNS zones to the service nodes. The DNS servers on the service nodes are DNS
slaves, so that if the management node goes down for some reason, then you still have the service nodes to be
able to do name resolution.</p>
<p>The configurations are described below for the two options, note the differences marked as Option #3.x.</p>
<p><strong>Note</strong>: for Option #3.1, only the DNS on the management node will use the <strong>forwarders</strong> setting. The DNS servers on the service nodes will always forward requests to the management node.</p>
<p><strong>Note</strong>: for Option #3.2, make sure <strong>servicenode.nameserver=2</strong> before you run <code class="docutils literal"><span class="pre">makedns</span> <span class="pre">-n</span></code>.</p>
<p>Once <strong>/etc/hosts</strong> is populated with all of the nodes&#8217; hostnames and IP addresses, configure DNS on the management node and start it:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">makedns</span> <span class="o">-</span><span class="n">n</span>
</pre></div>
</div>
<p>When the <strong>/etc/resolv.conf</strong> files for the compute nodes are created the value of the <strong>nameserver</strong>  in /etc/resolv.conf is gotten from <strong>site.nameservers</strong> or <strong>networks.nameservers</strong> if it&#8217;s specified.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t site nameservers=&quot;&lt;xcatmaster&gt;&quot;       # for Option #3.1
OR
chdef -t network &lt;my_network&gt; nameservers=&quot;&lt;xcatmaster&gt;&quot;   # for Option #3.1

chdef -t site nameservers=&quot;&lt;xcatmaster&gt;, MN_IP&quot;       # for Option #3.2
OR
chdef -t network &lt;my_network&gt; nameservers=&quot;&lt;xcatmaster&gt;, MN_IP&quot;   # for Option #3.2
</pre></div>
</div>
<p>The <strong>&lt;xcatmaster&gt;</strong> keyword will be interpreted as the value of the <strong>&lt;xcatmaster&gt;</strong> attribute of the node definition. The <strong>&lt;xcatmaster&gt;</strong> value for a node is the name of it&#8217;s server as known by the node. This would be either the cluster-facing name of the service node or the cluster-facing name of the management node.</p>
<p>Note: for Linux, the site <strong>nameservers</strong> value must be set to <strong>&lt;xcatmaster&gt;</strong> before you run <code class="docutils literal"><span class="pre">makedhcp</span></code>.</p>
<p>Make sure that the DNS service on the service nodes will be set up by xCAT.</p>
<p>Assuming you have all of your service nodes in a group called &#8220;service&#8221; you could run a command similar to the following.</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t group service setupnameserver=1       # for Option #3.1
chdef -t group service setupnameserver=2       # for Option #3.2
</pre></div>
</div>
<p>For Linux systems, make sure DHCP is set up on the service nodes.</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t group service setupdhcp=1
</pre></div>
</div>
<p>If you have not yet installed or diskless booted your service nodes, xCAT will take care of configuring and starting DNS on the service nodes at that time. If the service nodes are already running, restarting xcatd on them will cause xCAT to recognize the above setting and configure/start DNS:</p>
<div class="highlight-python"><div class="highlight"><pre>xdsh service &#39;service xcatd restart&#39;   # linux
</pre></div>
</div>
<p>If you add nodes or change node names or IP addresses later on, rerun makedns. The DNS on the service nodes will automatically pick up the new information.</p>
</div>
</div>
</div>
<div class="section" id="specifying-additional-network-interfaces-for-cluster-nodes">
<span id="id1"></span><h1>Specifying additional network interfaces for cluster nodes<a class="headerlink" href="#specifying-additional-network-interfaces-for-cluster-nodes" title="Permalink to this headline">¶</a></h1>
<p>You can specify additional interface information as part of an xCAT node definition. This information is used
by xCAT to populate the <strong>/etc/hosts</strong> file with the extra interfaces (using the makehosts command) and
providing xCAT adapter configuration scripts with the information required to automatically configure the
additional interfaces on the nodes.</p>
<p>To use this support you must set one or more of the following node definition attributes.</p>
<div class="highlight-python"><div class="highlight"><pre>nicips - IP addresses for additional interfaces (NIC). (Required)
nichostnamesuffixes - Hostname suffixes per NIC. This is a suffix to add to the node name to use for the hostname of the additional interface. (Optional)
nictypes - NIC types per NIC. The valid &quot;nictypes&quot; values are: &quot;ethernet&quot;, &quot;infiniband&quot;, and &quot;bmc&quot;. (Optional)
niccustomscripts - The name of an adapter configuration postscript to be used to configure the interface. (Optional)
nicnetworks - xCAT network definition names corresponding to each NIC. (ie. the network that the nic ip resides on.) (Optional)
nicaliases - Additional aliases to set for each additional NIC.
(These are added to the /etc/hosts file when using makehosts).(Optional)
</pre></div>
</div>
<p>The additional NIC information may be set by directly editing the xCAT <strong>nics</strong> table or by using the <strong>xCAT *defs</strong> commands to modify the node definitions.</p>
<p>The details for how to add the additional information is described below. As you will see, entering this
information manually can be tedious and error prone. This support is primarily targeted to be used in
conjunction with other IBM products that have tools to fill in this information in an automated way.</p>
<div class="section" id="managing-additional-interface-information-using-the-xcat-defs-commands">
<h2>Managing additional interface information using the <strong>xCAT *defs</strong> commands<a class="headerlink" href="#managing-additional-interface-information-using-the-xcat-defs-commands" title="Permalink to this headline">¶</a></h2>
<p>The <strong>xCAT *defs</strong> commands <strong>(mkdef, chdef, and lsdef)</strong> may be used to manage the additional NIC information in the xCAT database.</p>
<p>When using the these commands the expanded nic* attribute format will always be used.</p>
<div class="section" id="expanded-format-for-nic-attributes">
<h3>Expanded format for nic* attributes<a class="headerlink" href="#expanded-format-for-nic-attributes" title="Permalink to this headline">¶</a></h3>
<p>The expanded format will be the nics attribute name and the nic name, separated by a &#8221;.&#8221; (dot).(ie. &lt;nic attr=&#8221;&#8221; name=&#8221;&#8220;&gt;.&lt;nic name=&#8221;&#8220;&gt; )</p>
<p>For example, the expanded format for the <strong>nicips</strong> and <strong>nichostnamesuffixes</strong> attributes for a nic named <strong>eth1</strong> might be:</p>
<div class="highlight-python"><div class="highlight"><pre>nicips.eth1=10.1.1.6
nichostnamesuffixes.eth1=-eth1
</pre></div>
</div>
<p>If we assume that your xCAT node name is <strong>compute02</strong> then this would mean that you have an additional interface <strong>(&#8220;eth1&#8221;)</strong> and that the hostname and IP address are <strong>compute02-eth1</strong> and <strong>10.1.1.6</strong>.</p>
<p>A &#8220;|&#8221; delimiter is used to specify multiple values for an interface. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>nicips.eth2=60.0.0.7|70.0.0.7
nichostnamesuffixes.eth2=&#39;-eth2|-eth2-lab&#39;
</pre></div>
</div>
<p>This indicates that <strong>eth2</strong> gets two hostnames and two IP addresses. <strong>( compute02-eth2 gets 60.0.0.7 and compute02-eth2-lab&#8221; gets &#8220;70.0.0.7&#8221;.)</strong></p>
<p>For the <strong>nicaliases</strong> attribute a list of additional aliases may be provided.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">nicaliases</span><span class="o">.</span><span class="n">eth1</span><span class="o">=</span><span class="s">&#39;alias1 alias2&#39;</span>
<span class="n">nicaliases</span><span class="o">.</span><span class="n">eth2</span><span class="o">=</span><span class="s">&#39;alias3|alias4&#39;</span>
</pre></div>
</div>
<p>This indicates that the <strong>compute02-eth1</strong> hostname would get the additional two aliases, alias1 alias2, included in the <strong>/etc/hosts</strong> file, (when using the <code class="docutils literal"><span class="pre">makehosts</span></code> command).</p>
<p>The second line indicates that <strong>compute02-eth2</strong> would get the additional alias <strong>alias3</strong> and that <strong>compute02-eth-lab</strong> would get <strong>alias4</strong></p>
</div>
<div class="section" id="setting-individual-nic-attribute-values">
<h3>Setting individual nic attribute values<a class="headerlink" href="#setting-individual-nic-attribute-values" title="Permalink to this headline">¶</a></h3>
<p>The nic attribute values may be set using the <code class="docutils literal"><span class="pre">chdef</span></code> or <code class="docutils literal"><span class="pre">mkdef</span></code> commands. You can specify the nic* values
when creating an xCAT node definition with <code class="docutils literal"><span class="pre">mkdef</span></code> or you can update an existing node definition using <code class="docutils literal"><span class="pre">chdef</span></code>.</p>
<p>Note: <code class="docutils literal"><span class="pre">chdef</span></code> does not support using the &#8220;-m&#8221; and &#8220;-p&#8221; options to modify the nic* attributes.</p>
<p>nicips example:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t node -o compute02 nicips.eth1=11.10.1.2 nicips.eth2=&#39;80.0.0.2|70.0.0.2&#39;
</pre></div>
</div>
<p>NOTE: The management interface <strong>(eth0)</strong>, that the <strong>compute02</strong> IP is configured on, is not included in the list of additional nics. Although adding it to the list of nics would do no harm.</p>
<p>This <strong>nicips</strong> value indicates that there are two additional interfaces to be configured on node compute02,eth1 and eth2. The <strong>eth1</strong> interface will get the IP address <strong>11.10.1.2</strong>. The <strong>eth2</strong> interface will get two IP addresses, <strong>&#8220;80.0.0.2&#8221; and &#8220;70.0.0.2&#8221;</strong>.</p>
<p>nichostnamesuffixes example:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t node -o compute02 nichostnamesuffixes.eth1=-eth1 nichostnamesuffixes.eth2=&#39;-eth2|-eth2-lab&#39;
</pre></div>
</div>
<p>This value indicates that the hostname for <strong>&#8220;eth1&#8221;</strong> should be <strong>&#8220;compute02-eth1&#8221;</strong>. For <strong>&#8220;eth2&#8221;</strong> we had two IP addresses so now we need two suffixes. The hostnames for <strong>&#8220;eth2&#8221;</strong> will be <strong>&#8220;compute02-eth2&#8221;</strong> and <strong>&#8220;compute02-eth2-lab&#8221;</strong>. The IP for <strong>&#8220;compute02-eth2&#8221;</strong> will be <strong>&#8220;80.0.0.2&#8221;</strong> and the IP for <strong>&#8220;compute02-eth2-lab&#8221;</strong> will be <strong>&#8220;70.0.0.2&#8221;</strong>.</p>
<p>The suffixes provided may be any string that will conform to the DNS naming rules.</p>
<p>Important Note: According to DNS rules a hostname must be a text string up to 24 characters drawn from the alphabet (A-Z), digits (0-9), minus sign (-), and period (.). When you are specifying <strong>&#8220;nichostnamesuffixes&#8221;</strong> or <strong>&#8220;nicaliases&#8221;</strong> make sure the resulting hostnames will conform to this naming convention.</p>
<p>nictypes example:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t node -o compute02 nictypes.eth1=ethernet nictypes.eth2=&#39;ethernet|ethernet&#39;
</pre></div>
</div>
<p>This value indicates that all the nics are ethernet. The valid <strong>&#8220;nictypes&#8221;</strong> values are: <strong>&#8220;ethernet&#8221;</strong>, <strong>&#8220;infiniband&#8221;</strong>, and <strong>&#8220;bmc&#8221;</strong>.</p>
<p>niccustomscripts example:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t node -o compute02 niccustomscripts.eth1=cfgeth niccustomscripts.eth2=&#39;cfgeth|cfgeth&#39;
</pre></div>
</div>
<p>In this example <strong>&#8220;cfgeth&#8221;</strong> is the name of an adapter configuration postscript to be used to configure the interface.</p>
<p>nicnetworks example:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t node -o compute02 nicnetworks.eth1=clstrnet11 nicnetworks.eth2=&#39;clstrnet80|clstrnet-lab&#39;
</pre></div>
</div>
<p>In this example we are saying that the IP address of &#8220;eth0&#8221; (ie. compute02-eth1 -&gt; 11.10.1.2) is part of the xCAT network named <strong>&#8220;clstrnet11&#8221;</strong>. <strong>&#8220;compute02-eth2&#8221;</strong> is in network <strong>&#8220;clstrnet80&#8221;</strong> and <strong>&#8220;compute02-eth2-lab&#8221;</strong> is in <strong>&#8220;clstrnet-lab&#8221;</strong>.</p>
<p>By default the xCAT code will attempt to match the interface IP to one of the xCAT network definitions.</p>
<p>An xCAT network definition must be created for all networks being used in the xCAT cluster environment.</p>
<p>nicaliases example:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t node -o compute02 nicaliases.eth1=&quot;moe larry&quot;
</pre></div>
</div>
<p>In this example it specifies that, (when running <code class="docutils literal"><span class="pre">makehosts</span></code>), the <strong>&#8220;compute02-eth1&#8221;</strong> entry in the <strong>/etc/hosts</strong> file should get the additional aliases <strong>&#8220;moe&#8221;</strong> and <strong>&#8220;larry&#8221;</strong>.</p>
</div>
<div class="section" id="add-additional-nic-information-for-a-single-cluster-node">
<h3>Add additional NIC information for a single cluster node<a class="headerlink" href="#add-additional-nic-information-for-a-single-cluster-node" title="Permalink to this headline">¶</a></h3>
<p>In this example we assume that we have already designated that node <strong>&#8220;compute01&#8221;</strong> get IP address <strong>&#8220;60.0.0.1&#8221;</strong> which will be configured on interface <strong>&#8220;eth0&#8221;</strong>. This will be the xCAT management interface for the node. In addition to the management interface we also wish to include information for the <strong>&#8220;eth1&#8221;</strong> interface on node <strong>&#8220;compute01&#8221;</strong>. To do this we must set the additional nic information for this node. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t node -o compute01 nicips.eth1=&#39;80.0.0.1&#39; nichostnamesuffixes.eth1=&#39;-eth1&#39; nictypes.eth1=&#39;ethernet&#39; nicnetworks.eth1=&#39;clstrnet80&#39;
</pre></div>
</div>
<p>This information will be used to configure the <strong>&#8220;eth1&#8221;</strong> interface, (in addition to the management interface <strong>(eth0)</strong>), during the boot of the node.</p>
<p>Also, if you were to run <strong>&#8220;makehosts compute01&#8221;</strong> at this point you would see something like the following entries added to the <strong>/etc/hosts</strong> file.</p>
<div class="highlight-python"><div class="highlight"><pre>60.0.0.1 compute01 compute01.cluster60.com
80.0.0.1 compute01-eth1 compute01-eth1.cluster80.com
</pre></div>
</div>
<p>The domain names are found by checking the xCAT network definitions to see which one would include the IP address. The domain for the matching network is then used for the long name in the <strong>/etc/hosts</strong> file.</p>
<p>NOTE: If you specify the same IP address for a nic as you did for the management interface then the nic hostname will be considered an alias of the xCAT node hostname. For example, if you specified <strong>&#8220;60.0.0.1&#8221;</strong> for the eth1 <strong>&#8220;nicips&#8221;</strong> value then the <strong>/etc/hosts</strong> entry would be:</p>
<div class="highlight-python"><div class="highlight"><pre>60.0.0.1 compute01 compute01.cluster60.com compute01-eth1
</pre></div>
</div>
</div>
<div class="section" id="add-additional-nic-information-for-a-group-of-nodes">
<h3>Add additional NIC information for a group of nodes<a class="headerlink" href="#add-additional-nic-information-for-a-group-of-nodes" title="Permalink to this headline">¶</a></h3>
<p>In this example we&#8217;d like to configure additional <strong>&#8220;eth1&#8221;</strong> interfaces for a group of cluster nodes.</p>
<p>The basic approach will be to create an xCAT node group containing all the nodes and then use a regular expression to determine the actual &#8220;nicips&#8221; to use for each node.</p>
<p>For this technique to work you must set up the hostnames and IP address to a have a regular pattern. For more information on using regular expressions in the xCAT database see the <strong>xcatdb</strong> man page.</p>
<p>In the following example, the xCAT node group <strong>&#8220;compute&#8221;</strong> was defined to include all the computational nodes:<strong>compute01, compute02, compute03</strong> etc. (These hostnames/IPs will be mapped to the <strong>&#8220;eth0&#8221;</strong> interfaces.)</p>
<p>For the <strong>&#8220;eth1&#8221;</strong> interfaces on these nodes we&#8217;d like to have <strong>&#8220;compute01-eth1&#8221;</strong> map to <strong>&#8220;80.0.0.1&#8221;</strong>, and <strong>&#8220;compute02-eth1&#8221;</strong> to map to <strong>&#8220;80.0.0.2&#8221;</strong> etc.</p>
<p>To do this we could define the <strong>&#8220;compute&#8221;</strong> group attributes as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t group -o compute nicips=&#39;|\D+(\d+)|eth1!80.0.0.($1+0)|&#39; nichostnamesuffixes=&#39;eth1!-eth1&#39; nictypes=&#39;eth1!ethernet&#39;
</pre></div>
</div>
<p>These values will be applied to each node in the <strong>&#8220;compute&#8221;</strong> group. So, for example, if I list the attributes of <strong>&#8220;compute08&#8221;</strong> I&#8217;d see the following <strong>nic*</strong> attribute values set.</p>
<div class="highlight-python"><div class="highlight"><pre>lsdef compute08
Object name: compute08
     . . . .
     nicips.eth1=80.0.0.8
     nichostnamesuffixes.eth1=-eth1
     nictypes.eth1=ethernet
     . . . .
</pre></div>
</div>
<p>Here is a second example of using regular expressions to define multiple nodes:</p>
<div class="highlight-python"><div class="highlight"><pre>chdef -t group -o nictest nicips=&#39;|\D+(\d+)|ib0!10.4.102.($1*1)|&#39; nichostnamesuffixes=&#39;ib0!-ib&#39; nictypes=&#39;ib0!Infiniband&#39; nicnetworks=&#39;ib0!barcoo_infiniband&#39;

 lsdef nictest
   Object name: node01
   groups=nictest
   nichostnamesuffixes.ib0=-ib
   nicips.ib0=10.4.102.1
   nicnetworks.ib0=barcoo_infiniband
   nictypes.ib0=Infiniband
   postbootscripts=otherpkgs
   postscripts=syslog,remoteshell
</pre></div>
</div>
<p>NOTE: Make sure you haven&#8217;t already set <strong>nic*</strong> values in the individual node definitions since they would take precedence over the group value.</p>
</div>
<div class="section" id="using-expanded-stanza-file-format">
<h3>Using expanded stanza file format<a class="headerlink" href="#using-expanded-stanza-file-format" title="Permalink to this headline">¶</a></h3>
<p>The xCAT stanza file supports the expanded nic* attribute format.</p>
<p>It will contain the nic* attributes as described above.</p>
<div class="highlight-python"><div class="highlight"><pre>Example:

 compute01:
       objtype=node
       arch=x86_64
       mgt=ipmi
       cons=ipmi
       bmc=10.1.0.12
       nictypes.etn0=ethernet
       nicips.eth0=11.10.1.3
       nichostnamesuffixes.eth0=-eth0
       nicnetworks.eth0=clstrnet1
       nictypes.eth1=ethernet
       nicips.eth1=60.0.0.7|70.0.0.7
       nichostnamesuffixes.eth1=-eth1|-eth1-lab
       nicnetworks.eth1=clstrnet2|clstrnet3
       nicaliases.eth0=&quot;alias1 alias2&quot;
       nicaliases.eth1=&quot;alias3|alias4&quot;
</pre></div>
</div>
<p>The lsdef command may be used to create a stanza file in this format and the chdef/mkdef commands will read a stanza file in this format.</p>
</div>
<div class="section" id="using-lsdef-to-display-nic-attributes">
<h3>Using lsdef to display nic* attributes<a class="headerlink" href="#using-lsdef-to-display-nic-attributes" title="Permalink to this headline">¶</a></h3>
<p>If a node has any nic attributes set they will be displayed along with the node definition. The nic attribute values are displayed in the expanded format.</p>
<div class="highlight-python"><div class="highlight"><pre>lsdef compute02
</pre></div>
</div>
<p>If you would only like to see the <strong>nic*</strong> attributes for the node you can specify the <strong>&#8220;&#8211;nics&#8221;</strong> option on the command line.</p>
<div class="highlight-python"><div class="highlight"><pre>lsdef compute02 --nics
</pre></div>
</div>
<p>If you would like to display individual <strong>nic*</strong> attribute values you can use the <strong>&#8220;-i&#8221;</strong> option.</p>
<p>You can either specify the base nic* attribute name or the expanded name for a specific NIC.</p>
<div class="highlight-python"><div class="highlight"><pre>lsdef compute05 -i nicips,nichostnamesuffixes
 Object name: compute05
   nicips.eth1=11.1.89.7
   nicips.eth2=12.1.89.7
   nichostnamesuffixes.eth1=-lab
   nichostnamesuffixes.eth2=-app

 lsdef compute05 -i nicips.eth1,nichostnamesuffixes.eth1
  Object name: compute05
   nicips.eth1=11.1.89.7
   nichostnamesuffixes.eth1=-lab
</pre></div>
</div>
</div>
</div>
<div class="section" id="setting-addition-interface-information-using-the-xcat-tabedit-command">
<h2>Setting addition interface information using the xCAT tabedit command<a class="headerlink" href="#setting-addition-interface-information-using-the-xcat-tabedit-command" title="Permalink to this headline">¶</a></h2>
<p>Another option for setting the nic attribute values is to use the tabedit command. All the nic attributes for a node or group are stored in the xCAT database table named <strong>&#8220;nics&#8221;</strong>. You can edit the table directly using the xCAT <code class="docutils literal"><span class="pre">tabedit</span></code> command.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre>tabedit nics
</pre></div>
</div>
<p>For a description of the nic* table attributes see the nics table man page.</p>
<p>Sample table contents:</p>
<div class="highlight-python"><div class="highlight"><pre>#node,nicips,nichostnamesuffixes,nictypes,niccustomscripts,nicnetworks,nicaliases,comments,disable
&quot;compute03&quot;,&quot;eth0!11.10.1.3,eth1!60.0.0.7&quot;,&quot;eth0!-eth0,eth1!-eth1&quot;,&quot;eth0!ethernet,eth1!ethernet&quot;,,
&quot;eth0!clstrnet11,eth1!clstrnet60&quot;,eth0!moe,,
.   .   .   .   .
</pre></div>
</div>
</div>
</div>
<div class="section" id="limited-support-for-user-application-networks">
<h1>Limited support for user application networks<a class="headerlink" href="#limited-support-for-user-application-networks" title="Permalink to this headline">¶</a></h1>
<p>In some cases you may have additional user application networks in your site that are not specifically used for cluster management.If desired you can create xCAT network definitions for these networks.This not only provides a convenient way to keep track of the network details but the information can also be used to help set up name resolution for these networks on the cluster nodes.When you add a network definition that includes a <strong>&#8220;domain&#8221;</strong> value then that domain is automatically included the xCAT name resolution set up. This will enable the nodes to be able to resolve hostnames from the other domains.</p>
<p>For example, when you run <code class="docutils literal"><span class="pre">makedhcp</span> <span class="pre">-n</span></code> it will list all domains defined in the xCAT <strong>&#8220;site&#8221;</strong> definition and xCAT <strong>&#8220;network&#8221;</strong> definitions in the <strong>&#8220;option domain-search&#8221;</strong> entry of the shared-network stanza in the dhcp configuration file. This will cause dhcp to put these domains in the compute nodes&#8217; <strong>/etc/resolv.conf</strong> file every time it gets a dhcp lease.</p>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../gpu/index.html" class="btn btn-neutral float-right" title="GPUs" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Domain Name Resolution" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, IBM Corporation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.12',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>