

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Hardware RAID &mdash; xCAT 2.12 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="xCAT 2.12 documentation" href="../../index.html"/>
        <link rel="up" title="RAID" href="index.html"/>
        <link rel="next" title="Rest API" href="../restapi/index.html"/>
        <link rel="prev" title="RAID" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> xCAT
          

          
          </a>

          
            
            
              <div class="version">
                2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/install-guides/index.html">Install Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/admin-guides/index.html">Admin Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Advanced Topics</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../chain/index.html">Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cluster_maintenance/index.html">Cluster Maintenance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../confluent/index.html">Confluent</a></li>
<li class="toctree-l2"><a class="reference internal" href="../docker/index.html">Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../domain_name_resolution/index.html">Domain Name Resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gpu/index.html">GPUs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hamn/index.html">High Availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hierarchy/index.html">Hierarchical Clusters / Large Cluster Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kit/index.html">Software Kits</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mixed_cluster/index.html">Mixed Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../networks/index.html">Networks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ports/xcat_ports.html">Port Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../probe/index.html">xCAT probe</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">RAID</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="">Hardware RAID</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#discovering-disk-devices">Discovering disk devices</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-hardware-raid">Configuring hardware RAID</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../restapi/index.html">Rest API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security/index.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../softlayer/index.html">SoftLayer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../switches/index.html">Switch Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sysclone/index.html">System Clone (sysclone)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../zones/index.html">Zones</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/index.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../help.html">Need Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/index.html">Security Notices</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">xCAT</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">Advanced Topics</a> &raquo;</li>
      
          <li><a href="index.html">RAID</a> &raquo;</li>
      
    <li>Hardware RAID</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/advanced/raid/hardware_raid.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hardware-raid">
<h1>Hardware RAID<a class="headerlink" href="#hardware-raid" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>In many new compute machines, disks have been formatted into RAID oriented format in manufacturer, so admin must create raid arrays using these disks manually before provisioning OS. How to configure raid arrays in unattended way for hundreds of machines turns to be a problem.</p>
<p>IBM has offered a tool <code class="docutils literal"><span class="pre">iprconfig</span></code> to configure raid for IBM power machine. To leverage this tool, xCAT enabled it in xCAT genesis.ppc64 so that admin can use genesis.ppc64 to configure RAID arrays.</p>
<p>There are two commands (<code class="docutils literal"><span class="pre">diskdiscover</span></code> and <code class="docutils literal"><span class="pre">configraid</span></code>) shipped in <code class="docutils literal"><span class="pre">xCAT-genesis-scripts</span></code> package to support RAID arrays configuration using <code class="docutils literal"><span class="pre">iprconfig</span></code>, you can use the <code class="docutils literal"><span class="pre">runcmd</span></code> facility to configure raid in the hardware discovery procedure using them, <code class="docutils literal"><span class="pre">runcmd</span></code> is a facility which will be run in xcat genesis system. You can also use separated manual steps to use <code class="docutils literal"><span class="pre">configraid</span></code> in xcat genesis system shell.</p>
<ul class="simple">
<li><strong>diskdiscover</strong> : Scan disk devices in xcat genesis system, give out disks and RAID arrays information.</li>
<li><strong>configraid</strong> : Delete RAID arrays, create RAID arrays in xcat genesis system.</li>
</ul>
<p>Following sections show how to use <code class="docutils literal"><span class="pre">diskdiscover</span></code> and <code class="docutils literal"><span class="pre">configraid</span></code>, we assume <code class="docutils literal"><span class="pre">cn1</span></code> is compute node in all examples.</p>
</div>
<div class="section" id="discovering-disk-devices">
<h2>Discovering disk devices<a class="headerlink" href="#discovering-disk-devices" title="Permalink to this headline">¶</a></h2>
<p>Command <code class="docutils literal"><span class="pre">diskdiscover</span></code> scans disk devices, it can get the overview of disks and RAID arrays information from compute node; The outputs contain useful information for <code class="docutils literal"><span class="pre">configraid</span></code> to configure RAID arrays, user can get <code class="docutils literal"><span class="pre">pci_id</span></code>, <code class="docutils literal"><span class="pre">pci_slot_name</span></code>, <code class="docutils literal"><span class="pre">disk</span> <span class="pre">names</span></code>, <code class="docutils literal"><span class="pre">RAID</span> <span class="pre">arrays</span></code> and other informations from the outputs. It should be ran in xcat genesis system. It can be executed without input parameter or with pci_id, pci_id includes PCI vendor and device ID. For example, power8 SAS adapter pci_id is <code class="docutils literal"><span class="pre">1014:034a</span></code>, <code class="docutils literal"><span class="pre">1014</span></code> is vendor info, <code class="docutils literal"><span class="pre">034a</span></code> is PCI-E IPR SAS Adapter, more info about pci_id refer to <code class="docutils literal"><span class="pre">http://pci-ids.ucw.cz/read/PC/1014/</span></code>.</p>
<p>Here are steps to use <code class="docutils literal"><span class="pre">diskdiscover</span></code>:</p>
<ol class="arabic">
<li><p class="first">Start xCAT genesis system in compute node, let compute node <code class="docutils literal"><span class="pre">cn1</span></code> enter xCAT genesis system shell:</p>
<div class="highlight-python"><div class="highlight"><pre>nodeset cn1 shell
rpower cn1 reset
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">Note</span></code>: If user modify <code class="docutils literal"><span class="pre">diskdiscover</span></code> or <code class="docutils literal"><span class="pre">configraid</span></code> scripts, he needs to run the <code class="docutils literal"><span class="pre">mknb</span> <span class="pre">&lt;arch&gt;</span></code> command before <code class="docutils literal"><span class="pre">nodeset</span></code> command to update network boot root image.</p>
</li>
<li><p class="first">On xcat management node, executing <code class="docutils literal"><span class="pre">xdsh</span></code> to use <code class="docutils literal"><span class="pre">diskdiscover</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>xdsh cn1 diskdiscover
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-python"><div class="highlight"><pre>xdsh cn1 &#39;diskdiscover &lt;pci_id&gt;&#39;
</pre></div>
</div>
<p>The outputs format is as following:</p>
<div class="highlight-python"><div class="highlight"><pre># xdsh cn1 diskdiscover
cn1: --------------------------------------------------------------------------
cn1: PCI_ID     PCI_SLOT_NAME  Resource_Path  Device  Description   Status
cn1: ------     -------------  -------------  ------  -----------   ----------------
cn1: 1014:034a  0001:08:00.0   0:0:0:0        sg0     Function Disk Active
cn1: 1014:034a  0001:08:00.0   0:0:1:0        sg1     0 Array Member Active
cn1: -------------------------------------------------------------------
cn1: Get ipr RAID arrays by PCI_SLOT_NAME: 0001:08:00.0
cn1: -------------------------------------------------------------------
cn1: Name   PCI/SCSI Location         Description               Status
cn1: ------ ------------------------- ------------------------- -----------------
cn1: sda    0001:08:00.0/0:2:0:0       RAID 0 Disk Array         Optimized
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="configuring-hardware-raid">
<h2>Configuring hardware RAID<a class="headerlink" href="#configuring-hardware-raid" title="Permalink to this headline">¶</a></h2>
<div class="section" id="command-configraid-introduction">
<h3>Command configraid introduction<a class="headerlink" href="#command-configraid-introduction" title="Permalink to this headline">¶</a></h3>
<p>We can use <code class="docutils literal"><span class="pre">configraid</span></code> to delete RAID arrays or create RAID arrays:</p>
<div class="highlight-python"><div class="highlight"><pre>configraid delete_raid=[all|&quot;&lt;raid_array_list&gt;&quot;|null]
           stripe_size=[16|64|256]
           create_raid=&quot;rl#&lt;raidlevel&gt;|[pci_id#&lt;num&gt;|pci_slot_name#&lt;pci_slot_name&gt;|disk_names#&lt;sg0&gt;#..#&lt;sgn&gt;]|disk_num#&lt;number&gt;&quot; ...
</pre></div>
</div>
<p>Here are the input parameters introduction:</p>
<ol class="arabic">
<li><p class="first"><strong>delete_raid</strong> : List raid arrays which should be removed.</p>
<blockquote>
<div><ul class="simple">
<li>If its value is all, all raid arrays detected should be deleted.</li>
<li>If its value is a list of raid array names, these raid arrays will be deleted. Raid array names should be separated by <code class="docutils literal"><span class="pre">#</span></code>.</li>
<li>If its value is null or there is no delete_raid, no raid array will be deleted.</li>
<li>If there is no delete_raid, the default value is null.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><strong>stripe_size</strong> : It is optional used when creating RAID arrays. If stripe size is not specified, it will default to the recommended stripe size for the selected RAID level.</p>
</li>
<li><p class="first"><strong>create_raid</strong> : To create a raid array, add a line beginning with create_raid, all attributes keys and values are separated by <code class="docutils literal"><span class="pre">#</span></code>. The formats are as followings:</p>
<blockquote>
<div><ul>
<li><p class="first"><code class="docutils literal"><span class="pre">rl</span></code> means RAID level, RAID level can be any supported RAID level for the given adapter, such as 0, 10,  5,  6. <code class="docutils literal"><span class="pre">rl</span></code> is a mandatory attribute for every create_raid. Supported RAID level is depend on physical server&#8217;s RAID adapter.</p>
</li>
<li><p class="first">User can select disks based on following attributes value. User can find these value based on <code class="docutils literal"><span class="pre">diskdiscover</span></code> outputs as above section described.</p>
<blockquote>
<div><ol class="loweralpha simple">
<li><code class="docutils literal"><span class="pre">pci_id</span></code> is PCI vendor and device ID.</li>
<li><code class="docutils literal"><span class="pre">pci_slot_name</span></code> is the specified PCI location. If using <code class="docutils literal"><span class="pre">pci_slot_name</span></code>, this RAID array will be created using disks from it.</li>
<li><code class="docutils literal"><span class="pre">disk_names</span></code> is a list of advanced format disk names. If using <code class="docutils literal"><span class="pre">disk_names</span></code>, this RAID array will be created using these disks.</li>
</ol>
</div></blockquote>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">disk_num</span></code> is the number of disks this RAID array will contain, default value is all unused disks in its pci slot.</p>
</li>
</ul>
</div></blockquote>
</li>
</ol>
<p>More examples of input parameters:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Delete all original RAID arrays, create one RAID 10 array from pci_id <code class="docutils literal"><span class="pre">1014:034a</span></code>, it uses the first two available disks:</p>
<div class="highlight-python"><div class="highlight"><pre>delete_raid=all create_raid=&quot;rl#10|pci_id#1014:034a|disk_num#2&quot;
</pre></div>
</div>
</li>
<li><p class="first">Delete original RAID arrays sda and sdb on compute node, create one RAID 0 array from pci slot 0001:08:00.0, its RAID level is 0, it uses first two disks:</p>
<div class="highlight-python"><div class="highlight"><pre>delete_raid=&quot;sda#sdb&quot; create_raid=&quot;rl#0|pci_slot_name#0001:08:00.0|disk_num#2&quot;
</pre></div>
</div>
</li>
<li><p class="first">Create one RAID array from pci_id <code class="docutils literal"><span class="pre">1014:034a</span></code>, RAID level is 0, stripe_size is 256kb, using first two available disks:</p>
<div class="highlight-python"><div class="highlight"><pre>stripe_size=256 create_raid=&quot;rl#0|pci_id#1014:034a|disk_num#2&quot;
</pre></div>
</div>
</li>
<li><p class="first">Create two RAID arrays, RAID level is 0, one array uses one disks from pci_id 1014:034a, the other array uses two disks from pci_slot_name <code class="docutils literal"><span class="pre">0001:08:00.0</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>create_raid=&quot;rl#0|pci_id#1014:034a|disk_num#1&quot; create_raid=&quot;rl#0|pci_slot_name#0001:08:00.0|disk_num#2&quot;
</pre></div>
</div>
</li>
<li><p class="first">Create two RAID arrays, RAID level is 0, one array uses disks sg0 and sg1, the other array uses disks sg2 and sg3:</p>
<div class="highlight-python"><div class="highlight"><pre>create_raid=&quot;rl#0|disk_names#sg0#sg1&quot; create_raid=&quot;rl#0|disk_names#sg2#sg3&quot;
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="configuring-raid-arrays-process">
<h3>Configuring RAID arrays process<a class="headerlink" href="#configuring-raid-arrays-process" title="Permalink to this headline">¶</a></h3>
<p>Command <code class="docutils literal"><span class="pre">configraid</span></code> is running in xcat genesis system, its log is saved under <code class="docutils literal"><span class="pre">/tmp</span></code> on compute node genesis system.</p>
<div class="section" id="configuring-raid-in-hardware-discovery-procedure">
<h4>Configuring RAID in hardware discovery procedure<a class="headerlink" href="#configuring-raid-in-hardware-discovery-procedure" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Using <code class="docutils literal"><span class="pre">runcmd</span></code> facility to configure raid in the hardware discovery procedure, after configuring RAID, compute node enter xcat genesis system shell. In the following example, <code class="docutils literal"><span class="pre">configraid</span></code> deletes all original RAID arrays, it creates one RAID 0 array with first two disks from pci_id <code class="docutils literal"><span class="pre">1014:034a</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>nodeset cn1 runcmd=&quot;configraid delete_raid=all create_raid=rl#0|pci_id#1014:034a|disk_num#2&quot;,shell
rpower cn1 reset
</pre></div>
</div>
</li>
<li><p class="first">Using <code class="docutils literal"><span class="pre">rcons</span></code> to monitor the process:</p>
<div class="highlight-python"><div class="highlight"><pre>rcons cn1
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="configuring-raid-manually-in-xcat-genesis-system-shell">
<h4>Configuring RAID manually in xcat genesis system shell<a class="headerlink" href="#configuring-raid-manually-in-xcat-genesis-system-shell" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Starting xCAT genesis system in compute node, let compute node <code class="docutils literal"><span class="pre">cn1</span></code> enter xCAT genesis system shell:</p>
<div class="highlight-python"><div class="highlight"><pre>nodeset cn1 shell
rpower cn1 reset
</pre></div>
</div>
</li>
<li><p class="first">On xcat management node, executing <code class="docutils literal"><span class="pre">xdsh</span></code> to use <code class="docutils literal"><span class="pre">configraid</span></code> to configure RAID:</p>
<div class="highlight-python"><div class="highlight"><pre>xdsh cn1 &#39;configraid delete_raid=all create_raid=&quot;rl#0|pci_id#1014:034a|disk_num#2&quot;&#39;
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="monitoring-and-debuging-raid-configuration-process">
<h4>Monitoring and debuging RAID configuration process<a class="headerlink" href="#monitoring-and-debuging-raid-configuration-process" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first">Creating some RAID level arrays take very long time, for example, If user creates RAID 10, it will cost tens of minutes or hours. During this period, you can use xCAT xdsh command to monitor the progress of raid configuration.</p>
<div class="highlight-python"><div class="highlight"><pre>xdsh cn1 iprconfig -c show-config
</pre></div>
</div>
</li>
<li><p class="first">Logs for <code class="docutils literal"><span class="pre">configraid</span></code> is saved under <code class="docutils literal"><span class="pre">tmp</span></code> in compute node genesis system. User can login compute node and check <code class="docutils literal"><span class="pre">configraid</span></code> logs to debug.</p>
</li>
<li><p class="first">When configuring RAID in hardware discovery procedure, user can use <code class="docutils literal"><span class="pre">rcons</span></code> command to monitor or debug the process:</p>
<div class="highlight-python"><div class="highlight"><pre>rcons cn1
</pre></div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../restapi/index.html" class="btn btn-neutral float-right" title="Rest API" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="RAID" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, IBM Corporation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2.12',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>